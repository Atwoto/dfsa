<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10 Key Points Assessment Form</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 2rem; background-color: #f4f7f9; color: #333; }
        .container { max-width: 900px; margin: auto; background: #fff; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1, h2 { color: #1a253c; border-bottom: 2px solid #e1e8f0; padding-bottom: 10px; }
        h3 { color: #555; margin-top: 1.5rem; margin-bottom: 0.5rem; }
        .assessment-point { margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid #e1e8f0; }
        label { font-weight: 600; display: block; margin-bottom: 5px; }
        input[type="text"] { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 15px; padding: 10px; border: 1px solid #eee; border-radius: 4px; }
        .checkbox-group label { font-weight: normal; display: flex; align-items: center; }
        .checkbox-group input { width: auto; margin-right: 5px; }
        .status-message { margin-top: 1rem; padding: 1rem; font-weight: bold; text-align: center; border-radius: 4px; display:none; }
        .status-success { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
        .status-error { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        #submit-btn { display: block; width: 100%; padding: 15px; font-size: 1.2rem; font-weight: bold; color: #fff; background-color: #28a745; border: none; border-radius: 5px; cursor: pointer; margin-top: 2rem; }
        #submit-btn:hover { background-color: #218838; }
    </style>
</head>
<body>

<div class="container">
    <h1>10 Key Points Assessment Form</h1>
    
    <div class="assessment-point">
        <label for="applicant_name">Applicant Name</label>
        <input type="text" id="applicant_name" value="Global Reach Partners">
    </div>
    
    <div class="assessment-point">
        <h2>1. Financial Services, Endorsements, Prudential Category, etc.</h2>
        <h3>Primary Financial Service Type</h3>
        <div class="checkbox-group">
            <label><input type="checkbox" name="p1_service_type" value="Advisory" checked> Advisory</label>
            <label><input type="checkbox" name="p1_service_type" value="Arranging"> Arranging</label>
            <label><input type="checkbox" name="p1_service_type" value="Dealing in Investments"> Dealing in Investments</label>
            <label><input type="checkbox" name="p1_service_type" value="Managing Assets"> Managing Assets</label>
        </div>
        <h3>Requested Endorsements</h3>
        <div class="checkbox-group">
            <label><input type="checkbox" name="p1_endorsements" value="Dealing as Principal"> Dealing as Principal</label>
            <label><input type="checkbox" name="p1_endorsements" value="Dealing as Agent" checked> Dealing as Agent</label>
        </div>
        <h3>Prudential Category</h3>
        <div class="checkbox-group">
            <label><input type="checkbox" name="p1_prudential_cat" value="Category 3C" checked> Category 3C</label>
            <label><input type="checkbox" name="p1_prudential_cat" value="Category 4"> Category 4</label>
        </div>
        <h3>Legal Status</h3>
        <div class="checkbox-group">
            <label><input type="checkbox" name="p1_legal_status" value="Private Company Limited by Shares" checked> Private Company Limited by Shares</label>
            <label><input type="checkbox" name="p1_legal_status" value="LLP"> LLP</label>
        </div>
        <h3>Proposed Client Types</h3>
        <div class="checkbox-group">
            <label><input type="checkbox" name="p1_clients" value="Retail" checked> Retail</label>
            <label><input type="checkbox" name="p1_clients" value="Professional" checked> Professional</label>
        </div>
    </div>
    
    <div class="assessment-point">
        <h2>2. Business Overview</h2>
        <h3>Business Model Description</h3>
        <div class="checkbox-group">
             <label><input type="checkbox" name="p2_model_desc" value="Regional wealth management firm" checked> Regional wealth management firm</label>
             <label><input type="checkbox" name="p2_model_desc" value="Technology-focused advisory"> Technology-focused advisory</label>
        </div>
         <h3>Target Markets</h3>
        <div class="checkbox-group">
             <label><input type="checkbox" name="p2_markets" value="HNW clients" checked> HNW clients</label>
             <label><input type="checkbox" name="p2_markets" value="Corporate clients"> Corporate clients</label>
        </div>
    </div>
    
    <div class="assessment-point">
        <h2>10. Recommendation/IP conditions</h2>
        <h3>Recommendation</h3>
        <div class="checkbox-group">
             <label><input type="checkbox" name="p10_rec" value="Approval with standard conditions" checked> Approval with standard conditions</label>
             <label><input type="checkbox" name="p10_rec" value="Further review required"> Further review required</label>
             <label><input type="checkbox" name="p10_rec" value="Rejection recommended"> Rejection recommended</label>
        </div>
         <h3>Conditions</h3>
        <div class="checkbox-group">
             <label><input type="checkbox" name="p10_cond" value="Satisfactory review of IT audit" checked> Satisfactory review of IT audit</label>
             <label><input type="checkbox" name="p10_cond" value="Background check on CEO"> Background check on CEO</label>
             <label><input type="checkbox" name="p10_cond" value="Capital verification"> Capital verification</label>
        </div>
    </div>


    <button id="submit-btn">Submit Full Assessment</button>
    <div id="status" class="status-message"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    
    const submitBtn = document.getElementById('submit-btn');
    const statusDiv = document.getElementById('status');
    const API_BASE_URL = 'https://dfsa.vercel.app'; 

    function getCheckboxValues(name) {
        const checkboxes = document.querySelectorAll(`input[name="${name}"]:checked`);
        const values = Array.from(checkboxes).map(cb => cb.value);
        return values.join(', ');
    }

    submitBtn.addEventListener('click', async () => {
        statusDiv.style.display = 'block';
        statusDiv.className = 'status-message';
        statusDiv.textContent = 'Submitting...';

        const fullAssessmentData = {
            applicant_name: document.getElementById('applicant_name').value,
            // Point 1
            p1_service_type: getCheckboxValues('p1_service_type'),
            // Note: The API expects a field for endorsements, but we didn't add it to the DB schema.
            // For now, we'll skip sending it.
            p1_prudential_cat: getCheckboxValues('p1_prudential_cat'),
            p1_legal_status: getCheckboxValues('p1_legal_status'),
            p1_clients: getCheckboxValues('p1_clients'),
            // Point 2
            p2_model_desc: getCheckboxValues('p2_model_desc'),
            p2_markets: getCheckboxValues('p2_markets'),
            // (p2_geo_scope and p2_channels are missing from this form version)
            
            // Point 10
            p10_rec: getCheckboxValues('p10_rec'),
            p10_cond: getCheckboxValues('p10_cond'),
            
            // (The data for points 3-9 are missing from this form version but would be gathered here)
        };

        try {
            const response = await fetch(`${API_BASE_URL}/submit_assessment`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(fullAssessmentData),
            });

            const result = await response.json();
            if (!response.ok) { throw new Error(result.message || 'An unknown error occurred.'); }
            
            statusDiv.className = 'status-message status-success';
            statusDiv.textContent = 'Success! Assessment saved to database.';

        } catch (error) {
            statusDiv.className = 'status-message status-error';
            statusDiv.textContent = `Error: ${error.message}`;
        }
    });
});
</script>

</body>
</html>